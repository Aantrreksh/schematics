---

copyright:
  years: 2017, 2023
lastupdated: "2023-10-04"

keywords: schematics agent planning, planning agent, agent planning, command-line, api, ui

subcollection: schematics

---

{{site.data.keyword.attribute-definition-list}}

{{site.data.keyword.bplong_notm}} Agent beta-1 and beta-2 delivers a simplified agent installation process and policy for agent assignment. You can review the [beta-1 release](/docs/schematics?topic=schematics-schematics-relnotes&interface=cli#schematics-mar2223) documentation and explore. 
{: attention}

{{site.data.keyword.bpshort}} Agents is a [beta-1 feature](/docs/schematics?topic=schematics-agent-beta1-limitations) that is available for evaluation and testing purposes. It is not intended for production usage.
{: beta}

# Preparing for agent deployment
{: #plan-agent-overview}

Agents for {{site.data.keyword.bplong}} extends its ability to work directly with your cloud infrastructure on your private network or any isolated network zones. Agents allow users to be in control of the network configuration and access that they give to an agent to execute Terraform and Ansible jobs. Agents are designed not to require inbound access from {{site.data.keyword.bpshort}} and the opening of inbound firewall or network access ports. All communication between the agent and Schematics is outbound from the agent and under user control.    

{{site.data.keyword.bpshort}} Agents are a collection of microservices on Kubernetes clusters in your account. Additionally they use an {{site.data.keyword.objectstorageshort}} bucket as an intermediate or temporary datastore for the log files and state-files generated by Terraform or Ansible. 
{: shortdesc}

Review and complete the tasks below to prepare your {{site.data.keyword.cloud_notm}} environment to deploy a new agent.

- **Account and networks:** An agent provides {{site.data.keyword.bpshort}} Schematics the ability to run Terraform and Ansible jobs within a target account and the accounts private network. Network policies must be configured to allow the cluster the agent is deployed on to communicate back to Schematics, also to {{site.data.keyword.cloud}} APIs, services and for instance to a users private Git or Vault instances. Refer to the section on [Planning agent network access and configuration](/docs/schematics?topic=schematics-plan-agent-overview#agentb1-network-config) for more details. 
   - Record information about the allowed network zones and access.    
- **Kubernetes cluster:** A {{site.data.keyword.bpshort}} agent can be deployed on existing private or public [{{site.data.keyword.containerlong_notm}}](/docs/containers?topic=containers-clusters) clusters. You can use an existing cluster or provision a new cluster with the following minimum configuration.
   - Minimum configuration: Three worker nodes with `b4x16` flavor. This configuration can be used to run four Terraform or Ansible automation jobs in parallel.
   - Record information about the cluster such as `cluster ID`, `cluster resource group`,  and `region` for the later use.
- **{{site.data.keyword.cos_full_notm}}:** The {{site.data.keyword.bpshort}} Agent uses a {{site.data.keyword.objectstorageshort}} bucket to store temporary data. The COS instance must be in the same resource group as the cluster. Also the new bucket must be in the same region as the cluster. 
    - To deploy an agent, you must have the necessary privileges to create the `HMAC credentials` for the {{site.data.keyword.objectstorageshort}} bucket and store the credential as Kubernetes secret.
    - The COS instance and bucket must be created for the deploy to be successful. 
    - Record information about the COS resources such as `COS instance name`, `COS bucket name` for the later use.
- **IAM access permission:** At a minimum you must have access permissions for the Kubernetes service, Resource Group, {{site.data.keyword.objectstorageshort}}, and the {{site.data.keyword.bpshort}} service to [deploy an agent](/docs/schematics?topic=schematics-deploy-agent-overview&interface=cli).
    - When deploying an agent in another account, or when using a `ServiceID` or `APIKey`, you must ensure that the account administrator has granted the required permission for all the services enlisted in [permission to deploy an agent](/docs/schematics?topic=schematics-access#agent-permissions).
- **{{site.data.keyword.cloud_notm}} CLI:** Use the latest version of {{site.data.keyword.cloud_notm}} CLI and the [{{site.data.keyword.bpshort}} CLI v1.12.9](/docs/schematics?topic=schematics-setup-cli#install-schematics-plugin) or higher plugin to install an agent. For more information about plugin installation, see [installing {{site.data.keyword.bpshort}} CLI plugin](/docs/schematics?topic=schematics-setup-cli#install-schematics-plugin).

You can deploy only one agent instance in a Kubernetes cluster. To deploy multiple agents in a single {{site.data.keyword.cloud_notm}} account, they must be on different Kubernetes clusters. Each agent and cluster can cater to different network isolation zones in your Cloud environment.
{: note}

In this Beta release, an agent can only be associated with and run jobs for one {{site.data.keyword.cloud_notm}} account. Agents cannot be shared with other accounts or run jobs for multiple accounts. The diagram represents association of agents with a {{site.data.keyword.bpshort}} instance. Here multiple agents for a single account are associated with a single {{site.data.keyword.bpshort}} instance.

![Agent association with {{site.data.keyword.bpshort}} instances](images/new/sc-agents-world.svg){: caption="Agent association with {{site.data.keyword.bpshort}} instances" caption-side="bottom"}

This image is an artistic representation and does not reflect actual political or geographic boundaries. {: note}


## Planning agent network access and configuration
{: #agentb1-network-config}

{{site.data.keyword.bpshort}} Agents enable Terraform and Ansible jobs to be executed on your private network with direct access to work with resources on your private network and data centers. The following diagram illustrates a possible agent deployment model on a cluster in an environment with multiple VPCs connected via a transit gateway. 

![{{site.data.keyword.bpshort}} Agents connectivity](images/new/sc-agents-network.svg){: caption="{{site.data.keyword.bpshort}} Agents connectivity" caption-side="bottom"}

To work with private resources, your cloud environment must be configured to allow the agents cluster access to any required resources. Typically Terraform uses HTTPS to perform service configuration over port 443. Whereas Ansible uses SSH via port 22 to perform post provisioning VSI configuration.   

VPC Security Group or Access Control List policies must be configured to allow the agent cluster to access {{site.data.keyword.cloud}} APIs using HTTPS and any target VSIs using SSH. 

Access to data center resources can be configured through the use of [Direct Link](/docs/dl?topic=dl-dl-about) or a VPN connection.   

With agents you are responsible for the network security policies for the Kubernetes cluster and any VPC Security Group or Access Control List policies for the running agent and therefore the ability of the Terraform and Ansible automationsâ€™ to access to your private cloud resources.

## Agent capacity planning 
{: #agentb1-capacity-planning}

You are advised to monitor the resource usage for the {{site.data.keyword.bpshort}} Agent pods to scale the worker nodes in the Kubernetes cluster if required based on the number of concurrent jobs being executed. In the Beta-1 release, you can use the **Kubernetes dashboard** or [kubectl](/docs/containers?topic=containers-cli-install) commands to make changes to:   
    - the number of concurrent Terraform, and Ansible jobs.
    - the number of Terraform, and Ansible pods.
    - the resource limits for the agent deployment.


## Next steps
{: #agent-plan-nextsteps}

The next step is to [deploy an agent](/docs/schematics?topic=schematics-deploy-agent-overview).
